package io.spherelabs.designsystem.slider

import androidx.compose.runtime.Composable
import androidx.compose.runtime.MutableState
import androidx.compose.runtime.SideEffect
import kotlin.math.abs

@Composable
internal fun CorrectValueSideEffect(
    scaleToOffset: (Float) -> Float,
    valueRange: ClosedFloatingPointRange<Float>,
    trackRange: ClosedFloatingPointRange<Float>,
    valueState: MutableState<Float>,
    value: Float
) {
  SideEffect {
    val error = (valueRange.endInclusive - valueRange.start) / 1000
    val newOffset = scaleToOffset(value)
    if (abs(newOffset - valueState.value) > error) {
      if (valueState.value in trackRange) {
        valueState.value = newOffset
      }
    }
  }
}
